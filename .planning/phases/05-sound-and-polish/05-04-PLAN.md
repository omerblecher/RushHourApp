---
phase: 05-sound-and-polish
plan: "04"
type: execute
wave: 4
depends_on: ["05-03"]
files_modified: []
autonomous: false
requirements:
  - NFR-002
  - NFR-003
  - NFR-007

must_haves:
  truths:
    - "Gzipped bundle size is below 200KB"
    - "Game is fully playable offline (puzzles load, drag works, no Firebase errors surfaced to user)"
    - "All Phase 5 features work correctly on Chrome, Firefox, Safari, and Edge latest versions"
    - "Sound effects play correctly on all 4 browsers (or fail gracefully without errors)"
    - "Win animation (confetti + glow + WinModal delay) plays on all 4 browsers"
    - "Keyboard navigation works on all 4 browsers"
  artifacts:
    - path: "dist/"
      provides: "Production build output for bundle size measurement"
  key_links:
    - from: "npm run build"
      to: "dist/assets/*.js"
      via: "Vite production build"
      pattern: "dist/assets"
---

<objective>
Human verification of all Phase 5 features: bundle size check, offline behavior, and cross-browser smoke test across Chrome, Firefox, Safari, and Edge.

Purpose: NFR-002 (bundle < 200KB gzipped), NFR-003 (offline graceful degradation), and NFR-007 (cross-browser compatibility) require human validation that cannot be automated. This is the final quality gate before Phase 5 is complete.

Output: Verified game behavior on all target browsers, confirmed bundle size under limit.
</objective>

<execution_context>
@C:/Users/omerb/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/omerb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-sound-and-polish/05-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and measure bundle size</name>
  <files></files>
  <action>
Run the production build and measure gzipped bundle size:

```bash
npm run build
```

After build completes, check the bundle size output. Vite prints gzipped sizes in the build output. Look for the main JS chunk size (typically `dist/assets/index-[hash].js`).

If Vite does not show gzipped sizes automatically, run:
```bash
# Check gzipped size of main bundle
gzip -c dist/assets/index-*.js | wc -c
```

NFR-002 target: total gzipped JS < 200KB. Expected with howler (~7KB) + canvas-confetti (~10KB) + existing app: well within limit.

Report the measured gzipped bundle size in the verification output.
  </action>
  <verify>
Run `npm run build` and read gzipped sizes from output.
Confirm: Total gzipped JS is under 200KB.
  </verify>
  <done>Production build succeeds. Gzipped bundle size confirmed below 200KB. Size reported in summary.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete Phase 5 features and cross-browser behavior</name>
  <action>Human verifies all Phase 5 sound, animation, keyboard, and header features end-to-end. Confirms offline graceful degradation and cross-browser compatibility.</action>
  <what-built>
Phase 5 complete implementation:
- soundService singleton with slide, win, and level-start sounds
- Win celebration: confetti burst + board gold glow + 2-second delay before WinModal
- GameHeader with mute toggle, Help modal (how-to-play), and About modal (credits)
- Keyboard navigation: Tab to select vehicle, Arrow keys to move, Escape to deselect
- ARIA labels on all vehicles and grid for screen reader accessibility
- Board locked during win animation (no drag or keyboard input)
- Global mute persisted to localStorage; soft chime plays on unmute
  </what-built>
  <how-to-verify>
**Step 1 — Sound effects:**
1. Start the app (`npm run dev` or use production build)
2. Navigate to any puzzle and confirm the level-start sound plays when the puzzle loads
3. Drag a vehicle to a new cell — confirm slide sound plays once (not during drag, only after snap)
4. Win a puzzle — confirm win sound + confetti + board gold glow plays, WinModal appears ~2 seconds later

**Step 2 — Mute toggle:**
5. Click the mute button (speaker icon) in the game header — sound should stop
6. Unmute — a soft chime plays to confirm audio is restored
7. Refresh the page — mute state persists (stays muted if you muted it)

**Step 3 — Help and About modals:**
8. Click "?" button in game header — HelpModal opens with how-to-play text instructions
9. Click backdrop or "Got it!" — modal closes
10. Click "i" button — AboutModal opens with credits text
11. Click backdrop or "Close" — modal closes

**Step 4 — Keyboard navigation:**
12. Press Tab to cycle through vehicles — each focused vehicle shows a gold highlight ring
13. With a horizontal vehicle selected, press ArrowLeft/ArrowRight — vehicle moves, slide sound plays
14. Try ArrowUp/ArrowDown on a horizontal vehicle — nothing happens (silent ignore)
15. Press Escape — vehicle deselects, ring disappears

**Step 5 — Offline behavior (NFR-003):**
16. In Chrome DevTools, go to Network tab and check "Offline"
17. Refresh the page — game should load (assets are local), puzzles work, drag works
18. Firebase errors (if any) should NOT surface to the user — leaderboard just unavailable
19. Uncheck "Offline" to restore network

**Step 6 — Cross-browser smoke test (NFR-007):**
Test steps 1-4 above in each browser (or as many as available):
- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest) — if on Mac
- [ ] Edge (latest)

Confirm no console errors specific to one browser. Sound and confetti may behave slightly differently visually — acceptable as long as there are no thrown errors.

**Step 7 — Bundle size:**
Task 1 above reports the gzipped size. Confirm it is under 200KB.
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found (e.g., "sound doesn't play on Safari", "confetti missing on Firefox")</resume-signal>
</task>

</tasks>

<verification>
Phase 5 verified complete when:
1. Bundle size confirmed below 200KB gzipped
2. All Phase 5 features work in Chrome (minimum) and available target browsers
3. Offline mode: game playable, Firebase gracefully unavailable (no user-facing errors)
4. User approves the checkpoint with "approved"
</verification>

<success_criteria>
- Human verified: sound effects, mute toggle, win animation sequence, GameHeader modals, keyboard navigation
- Bundle size under 200KB gzipped (NFR-002)
- Game playable offline with graceful Firebase degradation (NFR-003)
- No thrown errors in any target browser during smoke test (NFR-007)
- User types "approved" to close the checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/05-sound-and-polish/05-04-SUMMARY.md`
</output>
